<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>{{path}}</title>
  <style type="text/css" media="screen">
    body {
      overflow: hidden;
    }
    #editor {
      margin: 0;
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
    }

    #doing {
      margin: 0;
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background: white;
      opacity: 0.9;
      display: none;
    }
    .doingtext{
      margin: 100px auto; text-align: center;
      width: 250px;
      line-height: 100px;
      border-radius: 20px;
      font-size: 20px;
      background:#00FF85;
    }
  </style>
</head>
<body>
  <pre id="editor">{{source}}</pre>
  <div id="doing">
    <div style="" class="doingtext">
    </div>
  </div>
<script src="/static/jquery-v1.11.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
  var editor = ace.edit("editor");
  editor.setTheme("ace/theme/twilight");
  $(function(){
    var mode = "ace/mode/text";
    var ix = window.location.pathname.lastIndexOf('.');
    if(ix>0){

    }

    editor.session.setMode(mode);
  });

  $(document).keydown(function(e){
    if( e.ctrlKey  == true && e.keyCode == 83 ){
      save();
      return false;
    }
  });

  function doing(t){
    $("#doing .doingtext").text(t);
    $("#doing").show();
  }

  function done(){
    $("#doing").hide();
  }

  function save(){
    doing('saving...');
     $.ajax({
      type: "POST",
      data: editor.getValue(),
      contentType: "string",
      success: function (data) {
        doing('save success!');
        setTimeout(done, 1500);
      },
      error:function(r){
        alert("save failed!");
        done();
      }
    })
  }
</script>

</body>
</html>
